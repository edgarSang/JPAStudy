##5 서비스: 클라이언트가 파드를 검색하고 통신을 가능하게 함
 - 쿠버네티스가 아닌 세계에선 sys관리자가 클라이언트 구성파일에 제공하는 서버의 IP주소나 호스트이름을 지정해 각 클라이언트 애플리케이션을 구성하는 거과 달리, 쿠버에선 이렇게 하면 동작안함
    - 파드는 일시적이다. 파드는 제거되거나, 파드수를 줄이거나, 언제든 다른노드로 이동가능
    - 쿠버는 노드에 파드를 스케줄링 후 파드가 시작 직전에 IP 할당, 미리 아이피 모름
    - 수평스케일은 여러파드가 동일한 서비스 제공의미, 클라는 서비스를 지원하는 파드수와 IP에 상관 x 파드의 개별 IP목록 유지 필요없음. 그대신 모든 파드는 단일 IP로 접근가능해야함
    
#### 5.1. 서비스 소개
 - 쿠버 서비스란 동일한 서비스를 제공하는 파드그룹에 단일 접점을 만들때 생성하는 리소스 서비스가 존재하는동안 절대 바뀌지않는 IP와 포트
 - 클라는 해당 IP와 포트로 접속 후, 해당 서비스를 지원하는 파드중 하나로 연결된다.
 - 서비스의 존재로인해 파드의 위치를 알필요가 없으므로 클러스터 안에서 이동가능.

#### 예제를 통한 서비스 설명
 - 프론트엔드 파드는 여러개 있을수 있지만, 백엔드 db파드는 하나만 있을것이다.
 - 시스템이 기동하려면 두 가지 문제를 해결 해야한다
    - 웹 서버가 수백개든 상관없이 외부 클라는 파드에 연결 가능해야한다
    - 프론트엔드 파드는 백 DB파드에 연결해야한다. DB는 파드내에서 실행되므로 시간이 지남에 따라 IP변경가능
 - FE 파드에 관한 서비스를 만들고 클라가 연결할수 있는 고정아이피 주소가 노출
 - 이와같이 백엔드도 서비스를 만들어 IP 가져옴
 - 프론트엔드 파드에서는 환경변수 또는 DNS 이름으로 백엔드서비스를 쉽게 찾을 수 있다.

##### 5.1.1. 서비스 생성
 - 서비스 연결은 서비스 뒷단의 모든 파드로 로드밸런싱 된다.
 - 정확히 어떤 파드가 서비스의 일부분인지 어떻게 정의?
 - 레이블 셀렉터를 기억할것이며 RC를 통해 동일한 세트속에 속한 파드를 지정하는 방법을 알것이다.
 - 동일한 매커니즘이 그대로 사용된다.

##### kubectl expose로 서비스 생성
 - 서비스 생성 가장 쉬운방법 = kubectl expose 사용
 -
```
kubctl get svc 
```

#### 클러스터 내에서 서비스 테스트
 - 몇가지방법으로 클러스터 내에서 서비스로 요청보낼 수 있다.
    - 클러스터 IP로 요청을 보내고, 응답을 로그로 남가는 파드를 만드는 것, 그런다음 파드의 로그를 검사해 서비스의 응답 확인
    - 쿠버네티스 노드로 ssh접속을 하고  curl 명령을 실행할 수 있다.
    - kubectl exec 명령어로 기존 파드에서 curl을 보낼 수 있다.
   
#### 실행중 컨테이너에 원격으로 명령어 실행
 - kubectl exec 명령어로 기존파드 컨테이너 내에서 원격으로 명령어 실행가능,
 - kubectl get pods 로 pods를 조회하고 , exec 명령어의 대상으로 하나를 선택해야함.
 - 또한 클러스터의 IP를 알아야한다.

```
command terminated with exit code 6
-> rc를 생성하니까 됨, rset은 안됨 ??;;
# 포트포와딩
kubectl port-forward service/redis-master 7000:redis
```

#### 서비스의 세션 어피니티 구성
 - 요청할때마다 다른 파드가 설정된다.
 - 특정클라이언트의 요청을 매번 같은파드로 갈려면 세션어피니티 속성을 기본값 대신 clientIp로 설정한다.
 - 쿠키 기반의 세션어피니티는 옵션이없다. 서비스는 TCP/UDP 패킷을 처리하고, 페이로드는 신경쓰지않는다.
 - 쿠키는 HTTP 프 로토콜의 구성이기때문에 서비스는 쿠키를 알 수 없다.

#### 동일한 서비스에서 여러개의 포트 노출
 - 포트스라는 옵션을통해 여러 포트로 노출시킬수있다.

#### 이름이 지정된 포트 사용
 - 지금까지는 대상 파드의 포트번호를 참조했지만, 각파드 포트에 이름을 지정하고, 서비스스펙에서 이름참조가능
 - 이렇게하면 포트이름을 변경하지 않고 파드스펙에서 포트번호를 변경하기만 하면된다.

#### 서비스 검색
 - 서비스를 만들면 파드에 액세스할수있는 안정적인 IP가 생긴다.
 - 클라이언트 파드는 서비스의 IP와 포트를 어떻게 알까?
 - 쿠버에서 클라잉너트 파드가 서비스의 IP와 포트를 검색할수 있는 방법을 제공한다.

#### 환경변수를 통한 서비스 검색
 - 파드를 만든후에 서비스를 만들면 서비스에 대한 환경변수를 설정할 수 없다.